userDeployments:
  enabled: true
  enableSubchart: true

  deployments:
    - name: "git-user-code"

      image:
        repository: "docker.io/dagster/dagster-k8s"
        tag: "1.12.1"
        pullPolicy: IfNotPresent

      port: 3030

      serverK8sConfig:
        containerConfig:
          command: ["/bin/bash", "-c"]
          args:
            - |
              set -euo pipefail

              echo "Cloning git repo..."
              git clone --depth 1 --branch "${GIT_REF}" "${GIT_URL}" /workspace

              echo "Launching Dagster user code server..."
              exec dagster code-server start \
                -h 0.0.0.0 \
                -p 3030 \
                --python-file /workspace/dagster/hello.py

          env:
            - name: GIT_URL
              value: "https://github.com/anandkpai/examples.git"

            - name: GIT_REF
              value: "main"
